X_centered^2
sqrt(sum(diag(X_centered^2)))
sqrt(sum(X_centered^2))
sqrt(sum(X_centered^2))
X_centered^2
sqrt(sum(X_centered^2))
sqrt(sum( diag(t(X_centered)%*%X_centered) ))
sum(X_centered^2)
sum( diag(t(X_centered)%*%X_centered) )
t(X_centered)%*%X_centered)
t(X_centered)%*%X_centered
frobenius_norm <-sqrt(sum( diag(t(X_centered)%*%X_centered) ))
frobenius_norm
X_scl <- X_cent/frobenius_norm
rm(list = ls()); gc(verbose = FALSE)
pacman::p_load(dplyr, ggplot2, tidyr, magrittr)
# nxp data
set.seed(190230)
X <- replicate(10, rnorm(100, 10, 2), simplify = "array")
# nxn identity matrix
I <- rep(0, nrow(X))%*% t(rep(0, nrow(X))) %>%
{diag(.) <- 1; .}
# nxn projection matrix: projects any vector onto subspace spanned by means
P <- (rep(1, nrow(X))%*%t(rep(1, nrow(X)))) / nrow(X)
# #+ PX gives column means repolicated across all rows
# all(round((P%*%X)[1,, drop = T] , 3) == round(colMeans(X), 3))
# subtract mean from each column of X
X_cent <- (I-P) %*% X
frobenius_norm <-sqrt(sum( diag(t(X_cent)%*%X_cent) ))
X_scl <- X_cent/frobenius_norm
X_scl
summary(X_scl)
X_scl[,1] %>% sum()
X_scl[,1] %>% var()
X_scl[,1] %>% sd()
X_scl %>% apply(., 2, var)
X_scl %>% apply(., 2, var) %>% sum()
X_scl %>% apply(., 2, sd) %>% sum()
sqrt(sum(
apply(X, 2, function(x) t(x)%*%x)
))
apply(X, 2, function(x) t(x)%*%x)
sum(
apply(X, 2, function(x) t(x)%*%x)
)
sqrt(sum(
apply(X, 2, function(x) t(x)%*%x)
))
frobenius_norm
pacman::p_load(readr, dplyr, snakecase, magrittr, ggplot2, patchwork, slingshot, SingleCellExperiment, TrajectoryUtils, scater, SummarizedExperiment, tidyr, tibble, stringr, myPackage)
# LOAD DAATA
obj <- qs::qread("processed-data/obj001.qs")
# SETUP
rm(list = ls()); gc()
pacman::p_load(readr, dplyr, snakecase, magrittr, ggplot2, patchwork, slingshot, SingleCellExperiment, TrajectoryUtils, scater, SummarizedExperiment, tidyr, tibble, stringr, myPackage)
#\\
#\\
#\\
#\\
# LOAD DAATA
obj <- qs::qread("processed-data/obj001.qs")
setwd("~/Documents/personal/R stuff/traj-alignment/")
# LOAD DAATA
obj <- qs::qread("processed-data/obj001.qs")
# original data
wine <- obj$data$orig
# two semi dependent matrices with unmatched samples
A <- obj$data$a
B <- obj$data$b
obj$data$idx$a$rows
list(a = obj$data$idx$a$rows, b = obj$data$idx$b$rows) %>%
setdiff_intersect()
list(a = obj$data$idx$a$rows, b = obj$data$idx$b$rows) %>% setdiff_intersect()
list(a = obj$data$idx$a$columns, b = obj$data$idx$b$columns) %>% setdiff_intersect()
X <- obj$data$a
Y <- obj$data$b
list(X = obj$data$idx$a$rows, Y = obj$data$idx$b$rows) %>% setdiff_intersect()
list(X = obj$data$idx$a$columns, Y = obj$data$idx$b$columns) %>% setdiff_intersect()
X
# ALIGN X Y BASES
X_decomp <- svd(X)
Y_decomp <- svd(Y)
Y_decomp
pacman::p_load(readr, dplyr, snakecase, magrittr, ggplot2, patchwork, slingshot, SingleCellExperiment, TrajectoryUtils, scater, SummarizedExperiment, tidyr, tibble, stringr, myPackage, zeallot)
decomp$u
X_decomp
X_decomp %>% str
c(D, U, V) %<-% X_decomp
D
U
V
names(X_decomp)
c(X_d, X_u, X_v) %<-% X_decomp
c(Y_d, Y_u, Y_v) %<-% Y_decomp
dim(X_u)
dim(X_v)
length(X_d)
# ALIGN X Y BASES
c(X_d, X_u, X_v) %<-% svd(X)
c(Y_d, Y_u, Y_v) %<-% svd(Y)
Y_d
obj$data$a
plot(X_u)
plot(prcomp(X)$x)
plot(X_v)
plot(prcomp(t(X))$x)
plot(X_d%*%X_v)
X_d%*%X_v
plot(X_d%*%t(X_v))
plot(X_v%*%X_d)
plot(X_v%*%X_d)
plot(prcomp(t(X))$x)
plot(X_v)
plot(prcomp(t(X))$x)
X %>% head
text(X_v, labels = names(X))
plot(X_v)
text(X_v, labels = names(X))
plot(X_u)
text(X_u, labels = rownames(X))
plot(X_u, type = "n")
text(X_u, labels = rownames(X))
plot(X_v, type = "n")
text(X_v, labels = names(X))
# making them have uniqwue obs  (bootstrapped in last script)
X <- obj$data$a %>%
distinct()
X
# making them have uniqwue obs  (bootstrapped in last script)
X <- obj$data$a %>%
distinct()
Y <- obj$data$b %>%
distinct()
# SVD on both
## singular values; observation coordinates; axes directions
c(X_d, X_u, X_v) %<-% svd(X)
c(Y_d, Y_u, Y_v) %<-% svd(Y)
plot(X_u, type = "n")
# SETUP
rm(list = ls()); gc()
setwd("~/Documents/personal/R stuff/traj-alignment/")
pacman::p_load(readr, dplyr, snakecase, magrittr, ggplot2, patchwork, slingshot, SingleCellExperiment, TrajectoryUtils, scater, SummarizedExperiment, tidyr, tibble, stringr, myPackage, zeallot)
#\\
#\\
#\\
#\\
# LOAD DAATA
obj <- qs::qread("processed-data/obj001.qs")
# rapply(obj, names, how = "list")
# original data
wine <- obj$data$orig
# two semi dependent matrices with unmatched samples
list(X = obj$data$idx$a$rows, Y = obj$data$idx$b$rows) %>% setdiff_intersect()
list(X = obj$data$idx$a$columns, Y = obj$data$idx$b$columns) %>% setdiff_intersect()
# making them have uniqwue obs  (bootstrapped in last script)
X <- obj$data$a %>%
distinct()
Y <- obj$data$b %>%
distinct()
#\\
#\\
#\\
#\\
# ALIGN X Y BASES
# SVD on both
## singular values; observation coordinates; axes directions
c(X_d, X_u, X_v) %<-% svd(X)
c(Y_d, Y_u, Y_v) %<-% svd(Y)
plot(X_u, type = "n")
X_u
plot(X_u, type = "n")
text(X_u, labels = rownames(X))
plot(X_v, type = "n")
text(X_v, labels = names(X))
plot(X_v, type = "n", xlim = c(0, NA), ylim = c(0, NA))
plot(X_v, type = "n", xlim = c(0, 2), ylim = c(0, 2))
text(X_v, labels = names(X))
plot(X_v, type = "n", xlim = c(-2, 2), ylim = c(-2, 2))
text(X_v, labels = names(X))
plot(X_v, type = "n", xlim = c(-1, 1), ylim = c(-1, 1))
text(X_v, labels = names(X))
plot(X_v, type = "n")
abline(h = 0, lty =2, col= 'grey50')
abline(v = 0, lty =2, col= 'grey50')
text(X_v, labels = names(X))
abline(h = 0, lty =2, col= 'grey50')
abline(v = 0, lty =2, col= 'grey50')
text(X_v, labels = names(X))
plot(X_v, type = "n")
abline(h = 0, lty =2, col= 'grey50')
abline(v = 0, lty =2, col= 'grey50')
text(X_v, labels = names(X))
plot(X_v, type = "n", ylim = c(-1,1))
abline(h = 0, lty =2, col= 'grey50')
abline(v = 0, lty =2, col= 'grey50')
text(X_v, labels = names(X))
plot(X_v, type = "n",
# ylim = c(-1,1)
)
plot(X_v, type = "n",
ylim = c(-1,1)
)
abline(h = 0, lty =2, col= 'grey50')
abline(v = 0, lty =2, col= 'grey50')
text(X_v, labels = names(X))
dotchart(X_d)
plot(X_d, type = "b")
plot(X_d %>% {sqrt(sum(.^2))} %>% {./sum(.)}, type = "b")
X_d %>% {sqrt(sum(.^2))} %>% {./sum(.)}
plot(X_d %>% {.^2} %>% {./sum(.)}, type = "b")
plot(X_d %>% {.^2} %>% {./sum(.)} %>% cumsum(), type = "b")
plot(X_d %>% {.^2} %>% {./sum(.)}, type = "b", main = "percent variance explained")
plot(X_u, type = "n", main = "Sample space")
text(X_u, labels = rownames(X))
plot(X_v, type = "n",
ylim = c(-1,1), main = "Feature space")
abline(h = 0, lty =2, col= 'grey50')
abline(v = 0, lty =2, col= 'grey50')
text(X_v, labels = names(X))
plot(X_d %>% {.^2} %>% {./sum(.)}, type = "b", main = "Percent variance explained")
X_u%*%X_d
plot(X_u%*%X_d, type = "n", main = "Sample space")
plot(X_u%*%X_d, type = "p", main = "Sample space")
plot(X_u, type = "p", main = "Sample space")
plot(X_u%*%X_d, type = "p", main = "Sample space")
plot(prcomp(X)$x, type = "p", main = "Sample space")
plot(X_u, type = "p", main = "Sample space")
plot(prcomp(X)$x, type = "p", main = "Sample space")
prcomp(X)$x
X_u%*%X_d
# making them have unique obs  (bootstrapped in last script)
X <- obj$data$a %>%
distinct() %>%
scale() %>%
data.frame()
Y <- obj$data$b %>%
distinct() %>%
scale() %>%
data.frame()
# SVD on both
## singular values; observation coordinates; axes directions
c(X_d, X_u, X_v) %<-% svd(X)
c(Y_d, Y_u, Y_v) %<-% svd(Y)
prcomp(X)$x
X_u%*%X_d
plot(prcomp(X)$x )
plot(X_u%*%X_d)
plot(X_u%*%t(X_d))
plot(X_d%*%X_u)
X_d
X_u%*%X_d
X_u
prcomp(X)$x
plot(prcomp(X)$x )
plot(X_u%*%X_d)
X_u
X_u%*%X_d
plot(prcomp(X)$x )
plot((X_u%*%X_d)[,1:2])
(X_u%*%X_d)[,1:2]
(X_u%*%X_d)
(X_u%*%X_d) %>% class
plot(X_u%*%X_d[,1:2])
X_u%*%X_d
X_u%*%X_d %>% dim
X_u
X_u
dim(X_u)
X_d
X_u%*%X_d
t(X_d)
X_u%*%t(X_d)
X_u%*%matrix(X_d)
matrix(X_d)
X_u%*%matrix(X_d)
X_u%*%t(matrix(X_d))
t(matrix(X_d))
t(X_d)
X_u
X_u%*%t(X_d)
dim(X_u)
dim(t(X_d))
X_u%*%t(X_d)
X_d_m <- matrix(0, nrow = length(X_d), ncol = length(X_d))
diag(X_d_m) <- X_d
X_d_m
X_u%*%X_d
X_u%*%t(X_d)
X_d
X_u%*%X_d_m
plot(prcomp(X)$x )
plot(X_u%*%X_d_m)
Y_d_m <- matrix(0, nrow = length(Y_d), ncol = length(Y_d))
diag(X_d_m) <- Y_d
plot(prcomp(X)$x )
plot(X_u%*%X_d_m)
all(prcomp(X)$x ==X_u%*%X_d_m)
sqrt(sum(prcomp(X)$x - X_u%*%X_d_m)^2))
sqrt(sum(prcomp(X)$x - X_u%*%X_d_m)^2)
sqrt(mean(prcomp(X)$x - X_u%*%X_d_m)^2)
plot(X_u%*%X_d_m, type = "n", main = "Sample space")
text(X_u%*%X_d_m, labels = rownames(X))
plot(X_v, type = "n",
ylim = c(-1,1), main = "Feature space")
abline(h = 0, lty =2, col= 'grey50')
abline(v = 0, lty =2, col= 'grey50')
text(X_v, labels = names(X))
plot(X_d %>% {.^2} %>% {./sum(.)}, type = "b", main = "Percent variance explained")
#\\
#\\
# SETUP
#\\
#\\
rm(list = ls()); gc()
setwd("~/Documents/personal/R stuff/traj-alignment/")
pacman::p_load(readr, dplyr, snakecase, magrittr, ggplot2, patchwork, slingshot, SingleCellExperiment, TrajectoryUtils, scater, SummarizedExperiment, tidyr, tibble, stringr, myPackage, zeallot)
#\\
#\\
# LOAD DATA
#\\
#\\
obj <- qs::qread("processed-data/obj001.qs")
# rapply(obj, names, how = "list")
# original data
wine <- obj$data$orig
# two semi dependent matrices with unmatched samples
list(X = obj$data$idx$a$rows, Y = obj$data$idx$b$rows) %>% setdiff_intersect()
list(X = obj$data$idx$a$columns, Y = obj$data$idx$b$columns) %>% setdiff_intersect()
# making them have unique obs  (bootstrapped in last script)
X <- obj$data$a %>%
distinct() %>%
scale() %>%
data.frame()
Y <- obj$data$b %>%
distinct() %>%
scale() %>%
data.frame()
#\\
#\\
# ALIGN X Y BASES
#\\
#\\
# SVD on both
## singular values; observation coordinates; axes directions
c(X_d, X_u, X_v) %<-% svd(X)
c(Y_d, Y_u, Y_v) %<-% svd(Y)
# construct ssingular value matrices
X_d_m <- matrix(0, nrow = length(X_d), ncol = length(X_d))
diag(X_d_m) <- X_d
Y_d_m <- matrix(0, nrow = length(Y_d), ncol = length(Y_d))
diag(X_d_m) <- Y_d
# sqrt(sum(prcomp(X)$x - X_u%*%X_d_m)^2)
plot(X_u%*%X_d_m, type = "n", main = "Sample space")
text(X_u%*%X_d_m, labels = rownames(X))
plot(X_v, type = "n",
ylim = c(-1,1), main = "Feature space")
abline(h = 0, lty =2, col= 'grey50')
abline(v = 0, lty =2, col= 'grey50')
text(X_v, labels = names(X))
plot(X_d %>% {.^2} %>% {./sum(.)}, type = "b", main = "Percent variance explained")
X%*%X_v
X
X_v
X%*%t(X_v)
X_v
as.matrix(X)%*%X_v
plot(as.matrix(X)%*%X_v)
plot(X_u%*%X_d_m)
Y_d <- matriY(0, nrow = length(Y_d_vec), ncol = length(Y_d_vec))
# SVD on both
## singular values; observation coordinates; axes directions
c(X_d_vec, X_u, X_v) %<-% svd(X)
c(Y_d_vec, Y_u, Y_v) %<-% svd(Y)
# construct ssingular value matrices
X_d <- matrix(0, nrow = length(X_d_vec), ncol = length(X_d_vec))
diag(X_d) <- X_d_vec
Y_d <- matrix(0, nrow = length(Y_d_vec), ncol = length(Y_d_vec))
diag(Y_d) <- Y_d_vec
plot(X_u%*%X_d_m, type = "n", main = "Sample space")
text(X_u%*%X_d_m, labels = rownames(X))
plot(X_v, type = "n",
ylim = c(-1,1), main = "Feature space")
abline(h = 0, lty =2, col= 'grey50')
abline(v = 0, lty =2, col= 'grey50')
text(X_v, labels = names(X))
plot(X_d %>% {.^2} %>% {./sum(.)}, type = "b", main = "Percent variance explained")
plot(X_d_vec %>% {.^2} %>% {./sum(.)}, type = "b", main = "Percent variance explained")
plot(as.matrix(X)%*%X_v)
plot(X_u%*%X_d_m)
# project samples into basis space same as sample space in svd
plot(as.matrix(X)%*%X_v)
plot(X_u%*%X_d_m)
plot(X_u%*%X_d_m, type = "n", main = "Sample space")
text(X_u%*%X_d_m, labels = rownames(X))
par(mfrow = c(3,1))
plot(X_u%*%X_d_m, type = "n", main = "Sample space")
text(X_u%*%X_d_m, labels = rownames(X))
plot(X_v, type = "n",
ylim = c(-1,1), main = "Feature space")
abline(h = 0, lty =2, col= 'grey50')
abline(v = 0, lty =2, col= 'grey50')
text(X_v, labels = names(X))
plot(X_d_vec %>% {.^2} %>% {./sum(.)}, type = "b", main = "Percent variance explained")
par(mfrow = c(1,1))
# project samples into basis space same as sample space in svd
par(mfrow = c(2,1))
plot(as.matrix(X)%*%X_v)
plot(X_u%*%X_d_m)
# project samples into basis space same as sample space in svd
par(mfrow = c(2,1))
plot(as.matrix(X)%*%X_v, main = "X•V")
plot(X_u%*%X_d_m,main = "U•D)
plot(X_u%*%X_d_m,main = "U•D")
# project samples into basis space same as sample space in svd
par(mfrow = c(2,1))
plot(as.matrix(X)%*%X_v, main = "X•V")
plot(X_u%*%X_d_m,main = "U•D")
par(mfrow = c(1,1))
X_basis <- X_v
#\\
#\\
# SETUP
#\\
#\\
rm(list = ls()); gc()
setwd("~/Documents/personal/R stuff/traj-alignment/")
pacman::p_load(readr, dplyr, snakecase, magrittr, ggplot2, patchwork, slingshot, SingleCellExperiment, TrajectoryUtils, scater, SummarizedExperiment, tidyr, tibble, stringr, myPackage, zeallot)
#\\
#\\
# LOAD DATA
#\\
#\\
obj <- qs::qread("processed-data/obj001.qs")
# rapply(obj, names, how = "list")
# original data
wine <- obj$data$orig
# two semi dependent matrices with unmatched samples
list(X = obj$data$idx$a$rows, Y = obj$data$idx$b$rows) %>% setdiff_intersect()
list(X = obj$data$idx$a$columns, Y = obj$data$idx$b$columns) %>% setdiff_intersect()
# making them have unique obs  (bootstrapped in last script)
X <- obj$data$a %>%
distinct()
Y <- obj$data$b %>%
distinct()
# making them have unique obs  (bootstrapped in last script)
X <- obj$data$orig[unique(obj$data$idx$a$rows),obj$data$idx$a$columns ]
X
# making them have unique obs  (bootstrapped in last script)
X <- obj$data$orig[unique(obj$data$idx$a$rows),obj$data$idx$a$columns ]
Y <- obj$data$orig[unique(obj$data$idx$b$rows),obj$data$idx$b$columns ]
#\\
#\\
# SETUP
#\\
#\\
rm(list = ls()); gc()
setwd("~/Documents/personal/R stuff/traj-alignment/")
pacman::p_load(readr, dplyr, snakecase, magrittr, ggplot2, patchwork, slingshot, SingleCellExperiment, TrajectoryUtils, scater, SummarizedExperiment, tidyr, tibble, stringr, myPackage, zeallot)
#\\
#\\
# LOAD DATA
#\\
#\\
obj <- qs::qread("processed-data/obj001.qs")
# rapply(obj, names, how = "list")
# original data
wine <- obj$data$orig
# two semi dependent matrices with unmatched samples
list(X = obj$data$idx$a$rows, Y = obj$data$idx$b$rows) %>% setdiff_intersect()
list(X = obj$data$idx$a$columns, Y = obj$data$idx$b$columns) %>% setdiff_intersect()
# making them have unique obs  (bootstrapped in last script)
X <- obj$data$orig[unique(obj$data$idx$a$rows),obj$data$idx$a$columns ]
Y <- obj$data$orig[unique(obj$data$idx$b$rows),obj$data$idx$b$columns ]
# center and scale using X mean and sd
X_mean <- colMeans(X)
X_mean
X_sd <- colSds(X)
X_sd
X_sd <- colSds(as.matrix(X))
X_sd
# center and scale using X mean and sd
X_mean <- colMeans(X)
X_sd <- colSds(as.matrix(X))
X_scld <- X %>%
sweep(., 2, X_mean, "-") %>%
sweep(., 2, X_sd, "/") %>%
#\\
#\\
# ALIGN X Y BASES
#\\
#\\
# SVD on both
## singular values; observation coordinates; axes directions
c(X_d_vec, X_u, X_v) %<-% svd(X)
X_scld <- X %>%
sweep(., 2, X_mean, "-") %>%
sweep(., 2, X_sd, "/")
X_scld
boxplot(X_scld)
Y_scld <- Y %>%
sweep(., 2, X_mean, "-") %>%
sweep(., 2, X_sd, "/")
boxplot(Y_scld)
boxplot(X_scld)
boxplot(Y_scld)
Y_scld <- Y %>%
sweep(., 2, X_mean, "-") %>%
sweep(., 2, X_sd, "/")
boxplot(Y_scld)
X_scld
boxplot(X_scld)
boxplot(X_scld, las = 2)
